# Fast Refresh è¯¦è§£ï¼šä¸ºä»€ä¹ˆéœ€è¦ "only-export-components" è§„åˆ™

## ğŸ“‹ ç›®å½•

- [ä»€ä¹ˆæ˜¯ Fast Refreshï¼Ÿ](#ä»€ä¹ˆæ˜¯-fast-refresh)
- [Fast Refresh çš„å·¥ä½œåŸç†](#fast-refresh-çš„å·¥ä½œåŸç†)
- [ä¸ºä»€ä¹ˆéœ€è¦ "only-export-components" è§„åˆ™ï¼Ÿ](#ä¸ºä»€ä¹ˆéœ€è¦-only-export-components-è§„åˆ™)
- [TanStack Router çš„ç‰¹æ®Šæƒ…å†µ](#tanstack-router-çš„ç‰¹æ®Šæƒ…å†µ)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)

## ä»€ä¹ˆæ˜¯ Fast Refreshï¼Ÿ

**Fast Refresh**ï¼ˆå¿«é€Ÿåˆ·æ–°ï¼‰æ˜¯ React çš„ä¸€ä¸ªå¼€å‘ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ åœ¨å¼€å‘æ—¶ç¼–è¾‘ç»„ä»¶ä»£ç åï¼Œ**ä¿æŒç»„ä»¶çŠ¶æ€**çš„åŒæ—¶æ›´æ–° UIï¼Œè€Œä¸éœ€è¦åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

### ä¼ ç»Ÿ HMR vs Fast Refresh

**ä¼ ç»Ÿ HMRï¼ˆHot Module Replacementï¼‰ï¼š**

```
ä¿®æ”¹ä»£ç  â†’ åˆ·æ–°æ•´ä¸ªé¡µé¢ â†’ ä¸¢å¤±æ‰€æœ‰çŠ¶æ€ï¼ˆè¡¨å•è¾“å…¥ã€æ»šåŠ¨ä½ç½®ç­‰ï¼‰
```

**Fast Refreshï¼š**

```
ä¿®æ”¹ç»„ä»¶ä»£ç  â†’ åªæ›´æ–°è¯¥ç»„ä»¶ â†’ ä¿æŒç»„ä»¶çŠ¶æ€ âœ…
```

### Fast Refresh çš„ä¼˜åŠ¿

1. âœ… **ä¿æŒçŠ¶æ€**ï¼šä¿®æ”¹ç»„ä»¶æ—¶ï¼Œç»„ä»¶çš„ stateã€props éƒ½ä¼šä¿ç•™
2. âœ… **å¿«é€Ÿåé¦ˆ**ï¼šå‡ ä¹ç¬é—´çœ‹åˆ°æ›´æ”¹ï¼Œæ— éœ€ç­‰å¾…é¡µé¢åˆ·æ–°
3. âœ… **æ›´å¥½çš„å¼€å‘ä½“éªŒ**ï¼šå¯ä»¥å®æ—¶çœ‹åˆ°æ ·å¼å’Œé€»è¾‘çš„æ›´æ”¹

## Fast Refresh çš„å·¥ä½œåŸç†

### 1. ç»„ä»¶è¯†åˆ«

Fast Refresh éœ€è¦èƒ½å¤Ÿ**è¯†åˆ«å“ªäº›æ˜¯ React ç»„ä»¶**ã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼è¯†åˆ«ï¼š

```typescript
// âœ… ç»„ä»¶ï¼šå‡½æ•°åä»¥å¤§å†™å­—æ¯å¼€å¤´
function MyComponent() { return <div>Hello</div> }
const MyComponent = () => <div>Hello</div>

// âœ… ç»„ä»¶ï¼šé»˜è®¤å¯¼å‡ºçš„å‡½æ•°
export default function MyComponent() { return <div>Hello</div> }

// âŒ ä¸æ˜¯ç»„ä»¶ï¼šæ™®é€šå‡½æ•°
function helper() { return 'hello' }
const data = { name: 'test' }
```

### 2. æ›´æ–°ç­–ç•¥

Fast Refresh æ ¹æ®æ–‡ä»¶å¯¼å‡ºçš„å†…å®¹å†³å®šæ›´æ–°ç­–ç•¥ï¼š

- **åªå¯¼å‡ºç»„ä»¶** â†’ å¯ä»¥å®‰å…¨åœ°çƒ­æ›´æ–°ï¼Œä¿æŒçŠ¶æ€
- **å¯¼å‡ºç»„ä»¶ + å…¶ä»–å†…å®¹** â†’ æ— æ³•ç¡®å®šæ›´æ–°ç­–ç•¥ï¼Œå¯èƒ½ä¸¢å¤±çŠ¶æ€

## ä¸ºä»€ä¹ˆéœ€è¦ "only-export-components" è§„åˆ™ï¼Ÿ

### é—®é¢˜åœºæ™¯

å½“ä¸€ä¸ªæ–‡ä»¶åŒæ—¶å¯¼å‡ºç»„ä»¶å’Œå…¶ä»–å†…å®¹æ—¶ï¼š

```typescript
// âŒ é—®é¢˜ä»£ç 
export const Route = createFileRoute('/')()  // éç»„ä»¶å¯¼å‡º
export function MyComponent() {              // ç»„ä»¶å¯¼å‡º
  return <div>Hello</div>
}
```

**Fast Refresh çš„å›°æƒ‘ï¼š**

1. è¿™ä¸ªæ–‡ä»¶å¯¼å‡ºäº† `Route`ï¼ˆä¸æ˜¯ç»„ä»¶ï¼‰
2. ä¹Ÿå¯¼å‡ºäº† `MyComponent`ï¼ˆæ˜¯ç»„ä»¶ï¼‰
3. Fast Refresh æ— æ³•ç¡®å®šï¼š
   - å¦‚æœæ›´æ–° `Route`ï¼Œæ˜¯å¦ä¼šå½±å“ç»„ä»¶ï¼Ÿ
   - å¦‚æœæ›´æ–°ç»„ä»¶ï¼Œ`Route` æ˜¯å¦éœ€è¦é‡æ–°åˆå§‹åŒ–ï¼Ÿ
   - æ›´æ–°åçŠ¶æ€æ˜¯å¦ä¼šä¸¢å¤±ï¼Ÿ

### è§„åˆ™çš„ä½œç”¨

`react-refresh/only-export-components` è§„åˆ™è¦æ±‚ï¼š

> **æ–‡ä»¶åº”è¯¥åªå¯¼å‡º React ç»„ä»¶ï¼Œæˆ–è€…åªå¯¼å‡ºéç»„ä»¶å†…å®¹ï¼Œä¸è¦æ··åˆå¯¼å‡ºã€‚**

è¿™æ ·å¯ä»¥ï¼š

- âœ… è®© Fast Refresh æ˜ç¡®çŸ¥é“æ–‡ä»¶çš„ç”¨é€”
- âœ… ç¡®ä¿çƒ­æ›´æ–°æ—¶çŠ¶æ€ä¸ä¼šä¸¢å¤±
- âœ… é¿å…æ½œåœ¨çš„æ›´æ–°é—®é¢˜

## TanStack Router çš„ç‰¹æ®Šæƒ…å†µ

### TanStack Router çš„ File-based Routing

TanStack Router ä½¿ç”¨ **file-based routing**ï¼Œæ¨èåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š

```typescript
// âœ… TanStack Router æ¨èæ–¹å¼
import { createFileRoute } from '@tanstack/react-router'

// å¯¼å‡º Route é…ç½®ï¼ˆéç»„ä»¶ï¼‰
export const Route = createFileRoute('/about')({
  component: About,
})

// å¯¼å‡ºç»„ä»¶
function About() {
  return <div>About Page</div>
}
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **æ–‡ä»¶å³è·¯ç”±**ï¼šä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªè·¯ç”±ï¼Œç»“æ„æ¸…æ™°
2. **ç±»å‹å®‰å…¨**ï¼šRoute å’Œç»„ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼ŒTypeScript ç±»å‹æ¨æ–­æ›´å¥½
3. **ä»£ç ç»„ç»‡**ï¼šè·¯ç”±é…ç½®å’Œç»„ä»¶é€»è¾‘åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤

### å†²çªç‚¹

- âŒ ESLint è§„åˆ™è¦æ±‚ï¼šåªå¯¼å‡ºç»„ä»¶
- âœ… TanStack Router è¦æ±‚ï¼šåŒæ—¶å¯¼å‡º Route å’Œç»„ä»¶

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä¸ºè·¯ç”±æ–‡ä»¶ç¦ç”¨è§„åˆ™ï¼ˆæ¨èï¼‰

åœ¨ ESLint é…ç½®ä¸­ï¼Œä¸ºè·¯ç”±æ–‡ä»¶ç¦ç”¨è¿™ä¸ªè§„åˆ™ï¼š

```javascript
// eslint.config.js
export default defineConfig([
  // ... å…¶ä»–é…ç½®
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // ... å…¶ä»–é…ç½®
      reactRefresh.configs.vite, // åŒ…å« only-export-components è§„åˆ™
    ],
  },
  // TanStack Router è·¯ç”±æ–‡ä»¶ï¼šå…è®¸åŒæ—¶å¯¼å‡º Route å’Œç»„ä»¶
  {
    files: ['src/routes/**/*.{ts,tsx}'],
    rules: {
      'react-refresh/only-export-components': 'off',
    },
  },
])
```

**ä¼˜ç‚¹ï¼š**

- âœ… ä¿æŒå…¶ä»–æ–‡ä»¶çš„è§„åˆ™æ£€æŸ¥
- âœ… å…è®¸è·¯ç”±æ–‡ä»¶ä½¿ç”¨ TanStack Router æ¨èæ–¹å¼
- âœ… ä¸å½±å“ Fast Refresh åœ¨å…¶ä»–æ–‡ä»¶ä¸­çš„å·¥ä½œ

### æ–¹æ¡ˆ 2ï¼šè°ƒæ•´è§„åˆ™çº§åˆ«ï¼ˆä¸æ¨èï¼‰

å°†è§„åˆ™ä» `error` æ”¹ä¸º `warn`ï¼š

```javascript
rules: {
  'react-refresh/only-export-components': 'warn',
}
```

**ç¼ºç‚¹ï¼š**

- âš ï¸ ä»ç„¶ä¼šæ˜¾ç¤ºè­¦å‘Š
- âš ï¸ åœ¨ CI/CD ä¸­å¯èƒ½ä»ç„¶å¤±è´¥

### æ–¹æ¡ˆ 3ï¼šåˆ†ç¦» Route å’Œç»„ä»¶ï¼ˆä¸æ¨èï¼‰

å°† Route é…ç½®å’Œç»„ä»¶åˆ†ç¦»åˆ°ä¸åŒæ–‡ä»¶ï¼š

```typescript
// routes/about.tsx
export const Route = createFileRoute('/about')({
  component: About,
})

// components/About.tsx
export function About() {
  return <div>About</div>
}
```

**ç¼ºç‚¹ï¼š**

- âŒ ä¸ç¬¦åˆ TanStack Router æ¨èæ–¹å¼
- âŒ å¢åŠ æ–‡ä»¶æ•°é‡
- âŒ ç±»å‹æ¨æ–­å¯èƒ½å—å½±å“

## Fast Refresh åœ¨è·¯ç”±æ–‡ä»¶ä¸­çš„å®é™…è¡¨ç°

### å®é™…æƒ…å†µ

å³ä½¿è·¯ç”±æ–‡ä»¶åŒæ—¶å¯¼å‡ºäº† Route å’Œç»„ä»¶ï¼Œ**Fast Refresh ä»ç„¶å¯ä»¥å·¥ä½œ**ï¼š

1. **ä¿®æ”¹ç»„ä»¶ä»£ç **ï¼šFast Refresh ä¼šæ›´æ–°ç»„ä»¶ï¼Œä¿æŒçŠ¶æ€ âœ…
2. **ä¿®æ”¹ Route é…ç½®**ï¼šå¯èƒ½éœ€è¦åˆ·æ–°é¡µé¢ï¼ˆå› ä¸ºè·¯ç”±é…ç½®å˜åŒ–ï¼‰

### ä¸ºä»€ä¹ˆè§„åˆ™ä»ç„¶å­˜åœ¨ï¼Ÿ

è¿™ä¸ªè§„åˆ™æ˜¯**é¢„é˜²æ€§çš„**ï¼š

- ç¡®ä¿ Fast Refresh çš„æœ€ä½³å®è·µ
- é¿å…æ½œåœ¨çš„è¾¹ç•Œæƒ…å†µ
- ä¿æŒä»£ç ç»“æ„æ¸…æ™°

ä½†å¯¹äº TanStack Router è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œå¯ä»¥å®‰å…¨åœ°ç¦ç”¨ã€‚

## æ€»ç»“

### Fast Refresh æ˜¯ä»€ä¹ˆï¼Ÿ

- React çš„å¼€å‘ç‰¹æ€§
- å…è®¸çƒ­æ›´æ–°ç»„ä»¶æ—¶ä¿æŒçŠ¶æ€
- éœ€è¦èƒ½å¤Ÿè¯†åˆ«ç»„ä»¶

### ä¸ºä»€ä¹ˆæœ‰è¿™ä¸ªè§„åˆ™ï¼Ÿ

- ç¡®ä¿ Fast Refresh èƒ½æ­£ç¡®è¯†åˆ«ç»„ä»¶
- é¿å…æ··åˆå¯¼å‡ºå¯¼è‡´çš„æ›´æ–°é—®é¢˜
- ä¿æŒä»£ç ç»“æ„æ¸…æ™°

### TanStack Router çš„æƒ…å†µ

- éœ€è¦åŒæ—¶å¯¼å‡º Route å’Œç»„ä»¶ï¼ˆå®˜æ–¹æ¨èï¼‰
- ä¸è§„åˆ™å†²çªï¼Œä½†å®é™…ä¸å½±å“ Fast Refresh
- è§£å†³æ–¹æ¡ˆï¼šä¸ºè·¯ç”±æ–‡ä»¶ç¦ç”¨è§„åˆ™

### æœ€ä½³å®è·µ

```javascript
// âœ… æ¨èï¼šä¸ºè·¯ç”±æ–‡ä»¶ç¦ç”¨è§„åˆ™
{
  files: ['src/routes/**/*.{ts,tsx}'],
  rules: {
    'react-refresh/only-export-components': 'off',
  },
}
```

è¿™æ ·æ—¢ä¿æŒäº†ä»£ç è´¨é‡æ£€æŸ¥ï¼Œåˆå…è®¸ä½¿ç”¨ TanStack Router çš„æœ€ä½³å®è·µã€‚

---

**ç›¸å…³èµ„æºï¼š**

- [React Fast Refresh æ–‡æ¡£](https://react.dev/learn/react-compiler#react-fast-refresh)
- [TanStack Router æ–‡æ¡£](https://tanstack.com/router)
- [ESLint React Refresh æ’ä»¶](https://github.com/ArnaudBarre/eslint-plugin-react-refresh)
